%ul.user-list
  - users.each_with_index do |user, i|
    - next if user.nil? || user.author.nil?
    - author = user.author
    - user_url = author.feed.local? ? "/users/#{author.username}" : author.feed.url
    %li.user{:class => i%2 == 0 ? "even" : "odd"}
      .avatar
        %a{:href => user_url}
          %img{:alt => "avatar", :src => author.avatar_url}/

      .info
        %a{:href => user_url}
          %b
            = author.display_name
          
          (#{author.username})
        .bio
          = author.bio

      - if current_user && current_user.feed != author.feed
        - unfollow_url = author.feed.local? ? "/users/#{author.username}/unfollow" : "/feeds/#{author.feed.id}/unsubscribe"

        - following = current_user.following?(author.feed.url)
        .follow{:class => (following ? "negative" : "positive")}
          - if following
            %form{:method => "post", :action => "/subscriptions/#{author.feed.id}"}
              %input{:type => "hidden", :name => "_method", :value => "delete"}
              %input.button.unfollow{:type => "submit", :value => "Unfollow", :id => "unfollow-#{author.feed.id}"}
          - else
            %form{:method => "post", :action => "/subscriptions"}
              %input{:type => "hidden", :name => "url", :value => "/feeds/#{author.feed.id}"}
              %input.button.follow{:type => "submit", :value => "Follow", :id => "follow-#{author.feed.id}"}
